<!DOCTYPE html>
<html lang="zh-Hans-CN"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=Edge"/><link rel="stylesheet" type="text/css" href="../css/modern-norm.min.css"/><link rel="stylesheet" type="text/css" href="../css/prism.min.css"/><link rel="stylesheet" type="text/css" href="../css/katex.min.css"/><link rel="stylesheet" type="text/css" href="../css/wolai.css"/><title>Python爬虫 - wolai 笔记</title><link rel="shortcut icon" href="media/python_1.png"></link></head><body><header><div class="image has" style="background-position-y: 50%; background-image: url(&quot;https://cdn.wostatic.cn/cover/thomas/oVKoDWUwwTvFKJRJaR8HBe.jpg&quot;)"></div><div class="title"><div class="banner"><div class="icon icon-image" style="background-image: url(&quot;media/python.png&quot;)"></div></div><div data-title="Python爬虫" class="main-title"></div></div></header><article><div class="wolai-block wolai-text"><div><span class="inline-wrap">环境的搭建</span></div></div><ol class="wolai-block"><li><div class="marker"></div><span class="inline-wrap">安装<span class="jill"></span>python: </span><span class="inline-wrap"><a href="https://www.cnblogs.com/zjazn/p/15364795.html"><span>https://www.cnblogs.com/zjazn/p/15364795.html</span></a></span></li><li><div class="marker"></div><span class="inline-wrap">安装环境：</span></li></ol><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Sh=" class="marker"></div><pre>python3 <span class="token operator">-</span>m venv venv_name
cd venv_name<span class="token operator">/</span>bin
source activate  <span class="token comment">//进入独立环境</span>
pip install beautifulsoup4  <span class="token comment">//安装beautifulsoup4</span>
python3 <span class="token comment">//直接python3</span>
<span class="token keyword module">from</span> bs4 <span class="token keyword module">import</span> <span class="token maybe-class-name">BeautifulSoup</span> <span class="token comment">//导入beautifulsoup4 不报错则安装成功</span>
<span class="token function">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> #退出python3

<span class="token comment">//如何要使用编辑器</span>
mkdir <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>scraping_std
cd  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>scraping_std
python <span class="token operator">-</span>m  idlelib <span class="token comment">//启动编辑器-"new File" - Run</span>
</pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap">在专业编辑器上使用专用编辑器
</span></div></div><div class="wolai-block wolai-center"><figure style="width: 100%"><img src="https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/16342170963681634217096336.png" style="width: 760px"/></figure></div><h2 class="wolai-block"><span class="inline-wrap">爬虫学习</span></h2><div class="wolai-block wolai-text"><div><span class="inline-wrap">BeautifulSoup<span class="jill"></span>在线文档</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">1、[正式实例]抓取果核剥壳文章</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Python==" class="marker"></div><pre><span class="token keyword module">import</span> <span class="token imports">requests</span>
<span class="token keyword module">from</span> bs4 <span class="token keyword module">import</span> <span class="token maybe-class-name">BeautifulSoup</span>
#下载网络文件
def <span class="token function">download</span><span class="token punctuation">(</span>file_url<span class="token punctuation">,</span> save_ful_name<span class="token punctuation">)</span><span class="token operator">:</span>
    file_stream <span class="token operator">=</span> requests<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span>file_url<span class="token punctuation">,</span> stream<span class="token operator">=</span><span class="token maybe-class-name">True</span><span class="token punctuation">)</span>
    <span class="token keyword">with</span> <span class="token function">open</span><span class="token punctuation">(</span>save_ful_name<span class="token punctuation">,</span> <span class="token string">'wb'</span><span class="token punctuation">)</span> <span class="token keyword module">as</span> file<span class="token operator">:</span>
        <span class="token keyword control-flow">for</span> block <span class="token keyword">in</span> file_stream<span class="token punctuation">.</span><span class="token method function property-access">iter_content</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token operator">:</span>
            file<span class="token punctuation">.</span><span class="token method function property-access">write</span><span class="token punctuation">(</span>block<span class="token punctuation">)</span>
#将文本保存为本地文件
def <span class="token function">write_to_local</span><span class="token punctuation">(</span>file_path<span class="token punctuation">,</span> content<span class="token punctuation">)</span><span class="token operator">:</span>
    paper <span class="token operator">=</span> <span class="token function">open</span><span class="token punctuation">(</span>file_path<span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">'w'</span><span class="token punctuation">,</span>encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
    paper<span class="token punctuation">.</span><span class="token method function property-access">write</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span>

#将页面url html转为对象
def <span class="token function">page_to_obj</span><span class="token punctuation">(</span>page_url<span class="token punctuation">)</span><span class="token operator">:</span>
    headers <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token string">'User-Agent'</span><span class="token operator">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4606.71 Safari/537.36'</span><span class="token punctuation">,</span>
        <span class="token string">'Accept'</span><span class="token operator">:</span> <span class="token string">'*/*'</span><span class="token punctuation">,</span>
        <span class="token string">'Accept-Language'</span><span class="token operator">:</span> <span class="token string">'zh-CN,zh;q=0.9'</span><span class="token punctuation">,</span>
        <span class="token string">'Accept-Encoding'</span><span class="token operator">:</span> <span class="token string">'gzip, deflate, br'</span><span class="token punctuation">,</span>
        <span class="token string">'DNT'</span><span class="token operator">:</span> <span class="token string">'1'</span><span class="token punctuation">,</span>
        <span class="token string">'Connection'</span><span class="token operator">:</span> <span class="token string">'keep-alive'</span>
    <span class="token punctuation">}</span>
    page <span class="token operator">=</span> requests<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span>page_url<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>
    <span class="token keyword control-flow">return</span> <span class="token function"><span class="token maybe-class-name">BeautifulSoup</span></span><span class="token punctuation">(</span>page<span class="token punctuation">.</span><span class="token property-access">content</span><span class="token punctuation">,</span> <span class="token string">'html.parser'</span><span class="token punctuation">)</span>
#进度视图
def <span class="token function">percentage_view</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token operator">:</span>
    sum_block <span class="token operator">=</span> <span class="token number">0</span>
    view <span class="token operator">=</span> <span class="token string">""</span>
    <span class="token keyword control-flow">if</span> val <span class="token operator">></span> <span class="token number">1</span><span class="token operator">:</span>
        sum_block <span class="token operator">=</span> <span class="token punctuation">(</span>val<span class="token punctuation">.</span><span class="token method function property-access">__floor__</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">__floor__</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword control-flow">else</span><span class="token operator">:</span>
        sum_block <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>val<span class="token operator">*</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">__floor__</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">__floor__</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    view <span class="token operator">+=</span> <span class="token string">"["</span>
    <span class="token keyword control-flow">for</span> block <span class="token keyword">in</span> <span class="token function">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> sum_block<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">:</span>
        view <span class="token operator">+=</span> <span class="token string">"#"</span>
    <span class="token keyword control-flow">for</span> blank <span class="token keyword">in</span> <span class="token function">range</span><span class="token punctuation">(</span>sum_block<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token operator">:</span>
        view <span class="token operator">+=</span> <span class="token string">"_"</span>
    view <span class="token operator">+=</span> <span class="token string">"]"</span>
    <span class="token keyword control-flow">return</span> view

<span class="token keyword control-flow">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token operator">:</span>
    count_obj <span class="token operator">=</span> <span class="token function">page_to_obj</span><span class="token punctuation">(</span><span class="token string">'https://www.ghxi.com/category/all'</span><span class="token punctuation">)</span>
    count_txt <span class="token operator">=</span> count_obj<span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">"class"</span><span class="token operator">:</span> <span class="token string">"disabled"</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">get_text</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    start_page_number <span class="token operator">=</span> <span class="token function">int</span><span class="token punctuation">(</span>count_txt<span class="token punctuation">.</span><span class="token method function property-access">split</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    end_page_number <span class="token operator">=</span> <span class="token function">int</span><span class="token punctuation">(</span>count_txt<span class="token punctuation">.</span><span class="token method function property-access">split</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword control-flow">for</span> i <span class="token keyword">in</span> <span class="token function">range</span><span class="token punctuation">(</span>start_page_number<span class="token punctuation">,</span> end_page_number<span class="token punctuation">)</span><span class="token operator">:</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"【开始抓取{}/{}页，当前进度{} 】"</span><span class="token punctuation">.</span><span class="token method function property-access">format</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>end_page_number<span class="token punctuation">,</span> <span class="token function">percentage_view</span><span class="token punctuation">(</span>i<span class="token operator">/</span>end_page_number<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        page_url <span class="token operator">=</span> <span class="token string">'https://www.ghxi.com/category/all/page/{}'</span><span class="token punctuation">.</span><span class="token method function property-access">format</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
        item_page_obj <span class="token operator">=</span> <span class="token function">page_to_obj</span><span class="token punctuation">(</span>page_url<span class="token punctuation">)</span>
        page_items <span class="token operator">=</span> item_page_obj<span class="token punctuation">.</span><span class="token method function property-access">findAll</span><span class="token punctuation">(</span><span class="token string">'h2'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">"class"</span><span class="token operator">:</span> <span class="token string">"item-title"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword control-flow">for</span> page_item <span class="token keyword">in</span> page_items<span class="token operator">:</span>
            page_item_title <span class="token operator">=</span> page_item<span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">get_text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">strip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">replace</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> <span class="token string">"或"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">replace</span><span class="token punctuation">(</span><span class="token string">"|"</span><span class="token punctuation">,</span> <span class="token string">"或"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">replace</span><span class="token punctuation">(</span><span class="token string">"?"</span><span class="token punctuation">,</span> <span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">replace</span><span class="token punctuation">(</span><span class="token string">"*"</span><span class="token punctuation">,</span> <span class="token string">"~"</span><span class="token punctuation">)</span>
            page_item_link <span class="token operator">=</span> page_item<span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">attrs</span><span class="token punctuation">[</span><span class="token string">'href'</span><span class="token punctuation">]</span>
            page_item_content <span class="token operator">=</span> <span class="token function">page_to_obj</span><span class="token punctuation">(</span>page_item_link<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">"class"</span><span class="token operator">:</span> <span class="token string">"entry-content"</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">get_text</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token function">write_to_local</span><span class="token punctuation">(</span>page_item_title<span class="token operator">+</span><span class="token string">".txt"</span><span class="token punctuation">,</span> page_item_content<span class="token punctuation">)</span>
            <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"{}\t\t{}"</span><span class="token punctuation">.</span><span class="token method function property-access">format</span><span class="token punctuation">(</span>page_item_title<span class="token punctuation">,</span> page_item_link<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap">2、[正式实例]  抓取乐愚蓝奏云链接[使用到下面的函数]</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Python==" class="marker"></div><pre>def <span class="token function">climb_pages_item</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span>
    share_file <span class="token operator">=</span> <span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'leyu_share_links.txt'</span><span class="token punctuation">,</span> <span class="token string">'a+'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
    def <span class="token function">link_write_local</span><span class="token punctuation">(</span>in_stream<span class="token punctuation">,</span> links<span class="token punctuation">)</span><span class="token operator">:</span>
        <span class="token keyword control-flow">for</span> link <span class="token keyword">in</span> links<span class="token operator">:</span>
            <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"正在写入文件..."</span><span class="token punctuation">)</span>
            in_stream<span class="token punctuation">.</span><span class="token method function property-access">write</span><span class="token punctuation">(</span><span class="token string">"{}\n"</span><span class="token punctuation">.</span><span class="token method function property-access">format</span><span class="token punctuation">(</span>json<span class="token punctuation">.</span><span class="token method function property-access">dumps</span><span class="token punctuation">(</span>link<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            in_stream<span class="token punctuation">.</span><span class="token method function property-access">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"[end]"</span><span class="token punctuation">)</span>

    #<span class="token number">1</span>、如何获取总页面数  返回总页数
    page_count <span class="token operator">=</span> <span class="token number">527</span>
    <span class="token keyword control-flow">for</span> n <span class="token keyword">in</span> <span class="token function">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>page_count<span class="token punctuation">)</span><span class="token operator">:</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"正在抓取{}/{}"</span><span class="token punctuation">.</span><span class="token method function property-access">format</span><span class="token punctuation">(</span>n<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span>page_count<span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">percentage_view</span><span class="token punctuation">(</span><span class="token punctuation">(</span>n<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">/</span>page_count<span class="token punctuation">)</span><span class="token punctuation">)</span>
        #如何根据页数，返回要跳转的链接  返回跳转链接
        tar_page_link <span class="token operator">=</span> <span class="token string">"https://bbs.leyuz.net/f/ruanjian?pn={}&amp;od=0"</span><span class="token punctuation">.</span><span class="token method function property-access">format</span><span class="token punctuation">(</span>n<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span>
        link_obj <span class="token operator">=</span> <span class="token function">page_to_obj</span><span class="token punctuation">(</span>tar_page_link<span class="token punctuation">)</span>
        #如何从页面中获取item对象； 返回item_obj对象
        items_obj <span class="token operator">=</span> link_obj<span class="token punctuation">.</span><span class="token method function property-access">findAll</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">"class"</span><span class="token operator">:</span> <span class="token string">"tag-title"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword control-flow">for</span> item_obj <span class="token keyword">in</span> items_obj<span class="token operator">:</span>
            #item_obj  返回item_link
            item_link <span class="token operator">=</span> <span class="token string">"https://bbs.leyuz.net"</span><span class="token operator">+</span>item_obj<span class="token punctuation">.</span><span class="token property-access">attrs</span><span class="token punctuation">[</span><span class="token string">'href'</span><span class="token punctuation">]</span>
            #从item详情页中获取content
            item_content <span class="token operator">=</span> <span class="token function">page_to_obj</span><span class="token punctuation">(</span>item_link<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token string">'article'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">"class"</span><span class="token operator">:</span> <span class="token string">"blog-main"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token keyword control-flow">if</span> item_content <span class="token operator">!=</span> <span class="token maybe-class-name">None</span><span class="token operator">:</span>
                item_content <span class="token operator">=</span> item_content<span class="token punctuation">.</span><span class="token method function property-access">get_text</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword control-flow">else</span><span class="token operator">:</span>
                item_content <span class="token operator">=</span> <span class="token string">''</span>
            #从item详情页中获取评论（数组对象）
            items_comment <span class="token operator">=</span> <span class="token function">page_to_obj</span><span class="token punctuation">(</span>item_link<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token string">'article'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">"class"</span><span class="token operator">:</span> <span class="token string">"am-comment"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
            item_sum_text <span class="token operator">=</span> <span class="token string">''</span>
            <span class="token keyword control-flow">if</span> items_comment <span class="token operator">!=</span> <span class="token maybe-class-name">None</span><span class="token operator">:</span>
                <span class="token keyword control-flow">for</span> item_comment <span class="token keyword">in</span> items_comment<span class="token operator">:</span>
                    item_sum_text <span class="token operator">+=</span> item_comment<span class="token punctuation">.</span><span class="token method function property-access">get_text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"\n"</span>
            item_all_content <span class="token operator">=</span> item_content<span class="token operator">+</span><span class="token string">"\n"</span><span class="token operator">+</span>item_sum_text
            #筛选特征分享链接
            _share <span class="token operator">=</span>  <span class="token function">get_share_link</span><span class="token punctuation">(</span>item_all_content<span class="token punctuation">,</span> <span class="token string">'lanzou'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">link_write_local</span><span class="token punctuation">(</span>share_file<span class="token punctuation">,</span> _share<span class="token punctuation">)</span>
            <span class="token function">print</span><span class="token punctuation">(</span>_share<span class="token punctuation">)</span>
    share_file<span class="token punctuation">.</span><span class="token method function property-access">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap">10、[正式函数] 函数</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Python=" class="marker"></div><pre><span class="token keyword module">import</span> <span class="token imports">requests</span>
<span class="token keyword module">from</span> bs4 <span class="token keyword module">import</span> <span class="token maybe-class-name">BeautifulSoup</span>
<span class="token keyword module">import</span> <span class="token imports">re</span>
<span class="token keyword module">from</span> <span class="token maybe-class-name">PyPDF2</span> <span class="token keyword module">import</span> <span class="token maybe-class-name">PdfFileReader</span><span class="token punctuation">,</span> <span class="token maybe-class-name">PdfFileWriter</span>

<span class="token keyword module">import</span> json
<span class="token keyword module">import</span> <span class="token imports">os</span>
<span class="token keyword module">from</span> tkinter <span class="token keyword module">import</span> <span class="token operator">*</span>
<span class="token keyword module">from</span> tkinter <span class="token keyword module">import</span> ttk


#下载网络文件
def <span class="token function">download</span><span class="token punctuation">(</span>file_url<span class="token punctuation">,</span> save_ful_name<span class="token punctuation">)</span><span class="token operator">:</span>
    file_stream <span class="token operator">=</span> requests<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span>file_url<span class="token punctuation">,</span> stream<span class="token operator">=</span><span class="token maybe-class-name">True</span><span class="token punctuation">)</span>
    <span class="token keyword">with</span> <span class="token function">open</span><span class="token punctuation">(</span>save_ful_name<span class="token punctuation">,</span> <span class="token string">'wb'</span><span class="token punctuation">)</span> <span class="token keyword module">as</span> file<span class="token operator">:</span>
        <span class="token keyword control-flow">for</span> block <span class="token keyword">in</span> file_stream<span class="token punctuation">.</span><span class="token method function property-access">iter_content</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token operator">:</span>
            file<span class="token punctuation">.</span><span class="token method function property-access">write</span><span class="token punctuation">(</span>block<span class="token punctuation">)</span>
#将文本保存为本地文件
def <span class="token function">write_to_local</span><span class="token punctuation">(</span>file_path<span class="token punctuation">,</span> content<span class="token punctuation">)</span><span class="token operator">:</span>
    paper <span class="token operator">=</span> <span class="token function">open</span><span class="token punctuation">(</span>file_path<span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">'w'</span><span class="token punctuation">,</span>encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
    paper<span class="token punctuation">.</span><span class="token method function property-access">write</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span>

#将页面url html转为对象
def <span class="token function">page_to_obj</span><span class="token punctuation">(</span>page_url<span class="token punctuation">)</span><span class="token operator">:</span>
    headers <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token string">'User-Agent'</span><span class="token operator">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4606.71 Safari/537.36'</span><span class="token punctuation">,</span>
        <span class="token string">'Accept'</span><span class="token operator">:</span> <span class="token string">'*/*'</span><span class="token punctuation">,</span>
        <span class="token string">'Accept-Language'</span><span class="token operator">:</span> <span class="token string">'zh-CN,zh;q=0.9'</span><span class="token punctuation">,</span>
        <span class="token string">'Accept-Encoding'</span><span class="token operator">:</span> <span class="token string">'gzip, deflate, br'</span><span class="token punctuation">,</span>
        <span class="token string">'DNT'</span><span class="token operator">:</span> <span class="token string">'1'</span><span class="token punctuation">,</span>
        <span class="token string">'Connection'</span><span class="token operator">:</span> <span class="token string">'keep-alive'</span>
    <span class="token punctuation">}</span>
    page <span class="token operator">=</span> requests<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span>page_url<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>
    <span class="token keyword control-flow">return</span> <span class="token function"><span class="token maybe-class-name">BeautifulSoup</span></span><span class="token punctuation">(</span>page<span class="token punctuation">.</span><span class="token property-access">content</span><span class="token punctuation">,</span> <span class="token string">'html.parser'</span><span class="token punctuation">)</span>
#进度视图
def <span class="token function">percentage_view</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token operator">:</span>
    sum_block <span class="token operator">=</span> <span class="token number">0</span>
    view <span class="token operator">=</span> <span class="token string">""</span>
    <span class="token keyword control-flow">if</span> val <span class="token operator">></span> <span class="token number">1</span><span class="token operator">:</span>
        sum_block <span class="token operator">=</span> <span class="token punctuation">(</span>val<span class="token punctuation">.</span><span class="token method function property-access">__floor__</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">__floor__</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword control-flow">else</span><span class="token operator">:</span>
        sum_block <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>val<span class="token operator">*</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">__floor__</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">__floor__</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    view <span class="token operator">+=</span> <span class="token string">"["</span>
    <span class="token keyword control-flow">for</span> block <span class="token keyword">in</span> <span class="token function">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> sum_block<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">:</span>
        view <span class="token operator">+=</span> <span class="token string">"#"</span>
    <span class="token keyword control-flow">for</span> blank <span class="token keyword">in</span> <span class="token function">range</span><span class="token punctuation">(</span>sum_block<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token operator">:</span>
        view <span class="token operator">+=</span> <span class="token string">"_"</span>
    view <span class="token operator">+=</span> <span class="token string">"]"</span>
    <span class="token keyword control-flow">return</span> view
    
#操作的字符
def <span class="token function">ctl_string</span><span class="token punctuation">(</span>ctl_string<span class="token punctuation">,</span> re_str<span class="token punctuation">,</span> limit <span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> object<span class="token operator">:</span>
    <span class="token keyword control-flow">if</span> <span class="token function">type</span><span class="token punctuation">(</span>limit<span class="token punctuation">)</span> <span class="token operator">==</span> list<span class="token operator">:</span>
        #进行搜索模式 参数： <span class="token function">操作的字符串</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span>  <span class="token function">re</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span> <span class="token punctuation">[</span>start_index<span class="token punctuation">,</span>end_index<span class="token punctuation">]</span>
        pattern <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token method function property-access">compile</span><span class="token punctuation">(</span>r<span class="token string">'{}'</span><span class="token punctuation">.</span><span class="token method function property-access">format</span><span class="token punctuation">(</span>re_str<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword control-flow">if</span> <span class="token function">len</span><span class="token punctuation">(</span>limit<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token operator">:</span>
            <span class="token keyword control-flow">return</span> pattern<span class="token punctuation">.</span><span class="token method function property-access">findall</span><span class="token punctuation">(</span>ctl_string<span class="token punctuation">)</span>
        <span class="token keyword control-flow">else</span><span class="token operator">:</span>
            <span class="token keyword control-flow">return</span> pattern<span class="token punctuation">.</span><span class="token method function property-access">findall</span><span class="token punctuation">(</span>ctl_string<span class="token punctuation">,</span> limit<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> limit<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    elif <span class="token function">type</span><span class="token punctuation">(</span>limit<span class="token punctuation">)</span> <span class="token operator">==</span> int<span class="token operator">:</span>
        #进入替换模式 <span class="token function">参数：操作的字符串</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span> <span class="token punctuation">[</span>re<span class="token punctuation">,</span>replace_str<span class="token punctuation">]</span> <span class="token function">count</span><span class="token punctuation">(</span>int<span class="token punctuation">)</span>
        <span class="token keyword control-flow">if</span> limit <span class="token operator">==</span> <span class="token number">0</span><span class="token operator">:</span>
            <span class="token keyword control-flow">return</span> re<span class="token punctuation">.</span><span class="token method function property-access">sub</span><span class="token punctuation">(</span>re_str<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> re_str<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> ctl_string<span class="token punctuation">)</span>
        <span class="token keyword control-flow">else</span><span class="token operator">:</span>
            <span class="token keyword control-flow">return</span> re<span class="token punctuation">.</span><span class="token method function property-access">sub</span><span class="token punctuation">(</span>re_str<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> re_str<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> ctl_string<span class="token punctuation">,</span> limit<span class="token punctuation">)</span>
    <span class="token keyword control-flow">else</span><span class="token operator">:</span>
        raise <span class="token known-class-name class-name">RuntimeError</span><span class="token punctuation">(</span><span class="token string">'第三个参数有重要作用，传入是一个整数值是替换操作，代表替换的数量，传入一个二值整形数组是查找，是查找的位置范围'</span><span class="token punctuation">)</span>



#将pdf指定的多个的页面转到新的pdf文件中
<span class="token function">#pdf_page_pick</span><span class="token punctuation">(</span><span class="token string">"ctl.pdf"</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span> to<span class="token operator">=</span><span class="token string">"split.pdf"</span><span class="token punctuation">)</span>
def <span class="token function">pdf_page_pick</span><span class="token punctuation">(</span>pdf_file_path<span class="token punctuation">,</span> pages<span class="token punctuation">,</span> to<span class="token punctuation">)</span><span class="token operator">:</span>
    pdf_file_stream <span class="token operator">=</span> <span class="token function">open</span><span class="token punctuation">(</span>r<span class="token string">"{}"</span><span class="token punctuation">.</span><span class="token method function property-access">format</span><span class="token punctuation">(</span>pdf_file_path<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"rb"</span><span class="token punctuation">)</span> #要读取的pdf文件
    pdf_read <span class="token operator">=</span> <span class="token function"><span class="token maybe-class-name">PdfFileReader</span></span><span class="token punctuation">(</span>pdf_file_stream<span class="token punctuation">)</span>  #读取pdf为处理对象
    pdf_write <span class="token operator">=</span> <span class="token function"><span class="token maybe-class-name">PdfFileWriter</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>  #创建pdf写处理对象
    <span class="token keyword control-flow">for</span> n <span class="token keyword">in</span> pages<span class="token operator">:</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"当前索引{}"</span><span class="token punctuation">.</span><span class="token method function property-access">format</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span>
        pdf_write<span class="token punctuation">.</span><span class="token method function property-access">addPage</span><span class="token punctuation">(</span>pdf_read<span class="token punctuation">.</span><span class="token method function property-access">getPage</span><span class="token punctuation">(</span>n<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  #将要求的页面添加到写的队列中
    child_pdf_stream <span class="token operator">=</span> <span class="token function">open</span><span class="token punctuation">(</span>r<span class="token string">"{}"</span><span class="token punctuation">.</span><span class="token method function property-access">format</span><span class="token punctuation">(</span>to<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"wb"</span><span class="token punctuation">)</span> #创建文件的输出流
    pdf_write<span class="token punctuation">.</span><span class="token method function property-access">write</span><span class="token punctuation">(</span>child_pdf_stream<span class="token punctuation">)</span> #开始输出


#传一html中file name
def <span class="token function">get_html_file_name</span><span class="token punctuation">(</span>page_text<span class="token punctuation">)</span><span class="token operator">:</span>
    _name <span class="token operator">=</span> <span class="token function">ctl_string</span><span class="token punctuation">(</span>page_text<span class="token punctuation">,</span> <span class="token string">"\>.+\.[0-9|A-z]+[^(com)|(con)|\>|\;]&lt;\/"</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword control-flow">if</span> <span class="token function">len</span><span class="token punctuation">(</span>_name<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token operator">:</span>
        <span class="token keyword control-flow">return</span> _name<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token operator">:</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span>
    <span class="token keyword control-flow">else</span><span class="token operator">:</span>
        <span class="token keyword control-flow">return</span> <span class="token maybe-class-name">None</span>
        
#扫描文本字符串有指定的链接并扫描最近可能的四位分享提取码
def <span class="token function">get_share_link</span><span class="token punctuation">(</span>text_str<span class="token punctuation">,</span> features<span class="token punctuation">)</span><span class="token operator">:</span>
   def <span class="token function">clean_key_str</span><span class="token punctuation">(</span>dirty_key<span class="token punctuation">)</span><span class="token operator">:</span>
       new_key <span class="token operator">=</span> <span class="token function">ctl_string</span><span class="token punctuation">(</span>dirty_key<span class="token punctuation">,</span> <span class="token string">"[\w]{4}"</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
       <span class="token keyword control-flow">if</span> <span class="token function">len</span><span class="token punctuation">(</span>new_key<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token operator">:</span>
           <span class="token keyword control-flow">return</span> <span class="token string">""</span>
       <span class="token keyword control-flow">return</span> new_key<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
   #安全访问数组，避免越界访问
   def <span class="token function">security_access_array</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span>index<span class="token punctuation">)</span><span class="token operator">:</span>
       <span class="token keyword control-flow">if</span> <span class="token function">len</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span> <span class="token operator">></span> index<span class="token operator">:</span>
           <span class="token keyword control-flow">return</span> arr<span class="token punctuation">[</span>index<span class="token punctuation">]</span>
       <span class="token keyword control-flow">else</span><span class="token operator">:</span>
           <span class="token keyword control-flow">return</span> <span class="token maybe-class-name">None</span>
   #开始准备利用正则获取分享链接信息，并最终加入到一个数组中
   re <span class="token operator">=</span> <span class="token string">'http[s]?:\/\/[A-z|0-9|\.|\/|\-]+'</span>
   share_links <span class="token operator">=</span> <span class="token function">ctl_string</span><span class="token punctuation">(</span>text_str<span class="token punctuation">,</span> re<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  #不具有特征的分享链接或全部链接
   key_seach_between <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
   <span class="token keyword control-flow">for</span> share <span class="token keyword">in</span> share_links<span class="token operator">:</span>
       index <span class="token operator">=</span> text_str<span class="token punctuation">.</span><span class="token method function property-access">index</span><span class="token punctuation">(</span>share<span class="token punctuation">)</span>
       <span class="token keyword control-flow">if</span><span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>key_seach_between<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">:</span>
           key_seach_between<span class="token punctuation">.</span><span class="token method function property-access">insert</span><span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>key_seach_between<span class="token punctuation">)</span><span class="token punctuation">,</span> index<span class="token punctuation">)</span>
       key_seach_between<span class="token punctuation">.</span><span class="token method function property-access">insert</span><span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>key_seach_between<span class="token punctuation">)</span><span class="token punctuation">,</span> index<span class="token operator">+</span><span class="token function">len</span><span class="token punctuation">(</span>share<span class="token punctuation">)</span><span class="token punctuation">)</span>
   key_seach_between<span class="token punctuation">.</span><span class="token method function property-access">insert</span><span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>key_seach_between<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
   #开始获取分享链接的提取码并且合并分享信息到一个对象数组中
   shares <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> #全部的分享信息
   share_info <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'link'</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token string">'key'</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">}</span>  #分享信息单元
   point <span class="token operator">=</span> <span class="token number">0</span>
   end_index <span class="token operator">=</span> <span class="token function">len</span><span class="token punctuation">(</span>key_seach_between<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">2</span>
   current_link_index <span class="token operator">=</span> <span class="token number">0</span>
   <span class="token keyword control-flow">while</span><span class="token punctuation">(</span>point <span class="token operator">&lt;=</span> end_index<span class="token punctuation">)</span><span class="token operator">:</span>
        tail_index <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token keyword control-flow">if</span> key_seach_between<span class="token punctuation">[</span>point<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token operator">:</span>
            tail_index <span class="token operator">=</span> <span class="token function">len</span><span class="token punctuation">(</span>text_str<span class="token punctuation">)</span>
        <span class="token keyword control-flow">else</span><span class="token operator">:</span>
            tail_index <span class="token operator">=</span> key_seach_between<span class="token punctuation">[</span>point<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span>
        <span class="token function">#print</span><span class="token punctuation">(</span><span class="token string">"在{}到{}这个范围查找提取码"</span><span class="token punctuation">.</span><span class="token method function property-access">format</span><span class="token punctuation">(</span>key_seach_between<span class="token punctuation">[</span>point<span class="token punctuation">]</span><span class="token punctuation">,</span> tail_index <span class="token punctuation">)</span><span class="token punctuation">)</span>

        key <span class="token operator">=</span> <span class="token function">security_access_array</span><span class="token punctuation">(</span><span class="token function">ctl_string</span><span class="token punctuation">(</span>text_str<span class="token punctuation">,</span> <span class="token string">"[:|：| ]+?[0-9|A-z]{4}[^0-9|^A-z]+?"</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>key_seach_between<span class="token punctuation">[</span>point<span class="token punctuation">]</span><span class="token punctuation">,</span> tail_index<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
        share_info<span class="token punctuation">[</span><span class="token string">'link'</span><span class="token punctuation">]</span> <span class="token operator">=</span> share_links<span class="token punctuation">[</span>current_link_index<span class="token punctuation">]</span>
        share_info<span class="token punctuation">[</span><span class="token string">'key'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">clean_key_str</span><span class="token punctuation">(</span>key <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>key <span class="token operator">!=</span> <span class="token maybe-class-name">None</span><span class="token punctuation">)</span> <span class="token keyword control-flow">else</span> <span class="token string">''</span><span class="token punctuation">)</span>
        shares<span class="token punctuation">.</span><span class="token method function property-access">insert</span><span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>shares<span class="token punctuation">)</span><span class="token punctuation">,</span> share_info<span class="token punctuation">)</span>
        point <span class="token operator">+=</span> <span class="token number">2</span>
        current_link_index <span class="token operator">+=</span> <span class="token number">1</span>
        share_info <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'link'</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token string">'key'</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">}</span> #重置分享信息
   #筛选出具有特征的链接
   false_link_count <span class="token operator">=</span> <span class="token number">0</span>
   _shares <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> #具有目标特征的分享链接
   <span class="token keyword control-flow">for</span> _share <span class="token keyword">in</span> shares<span class="token operator">:</span>
       <span class="token keyword control-flow">try</span><span class="token operator">:</span>
           has_share <span class="token operator">=</span> _share<span class="token punctuation">[</span><span class="token string">'link'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token method function property-access">index</span><span class="token punctuation">(</span>features<span class="token punctuation">)</span>
       except <span class="token maybe-class-name">Exception</span> <span class="token keyword module">as</span> e<span class="token operator">:</span>
           has_share <span class="token operator">=</span> <span class="token maybe-class-name">None</span>
           false_link_count <span class="token operator">+=</span> <span class="token number">1</span>
       <span class="token keyword control-flow">if</span> has_share <span class="token operator">!=</span> <span class="token maybe-class-name">None</span><span class="token operator">:</span>
           _shares<span class="token punctuation">.</span><span class="token method function property-access">insert</span><span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>_shares<span class="token punctuation">)</span><span class="token punctuation">,</span> _share<span class="token punctuation">)</span>
   <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"扫描完成，一共有：{}个链接，特征链接{}个，假链接{}个！"</span><span class="token punctuation">.</span><span class="token method function property-access">format</span><span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>shares<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>shares<span class="token punctuation">)</span><span class="token operator">-</span>false_link_count<span class="token punctuation">,</span> false_link_count<span class="token punctuation">)</span><span class="token punctuation">)</span>
   <span class="token keyword control-flow">return</span> _shares
   
   
#对文本行进行操作，返回为新行
def <span class="token function">text_line_ctl</span><span class="token punctuation">(</span>local_file_path<span class="token punctuation">,</span> ctl_fun<span class="token punctuation">)</span><span class="token operator">:</span>
    ##
    # def <span class="token function">_ctl</span><span class="token punctuation">(</span>line<span class="token punctuation">,</span> line_n<span class="token punctuation">)</span><span class="token operator">:</span>
    #     <span class="token keyword control-flow">if</span> line_n <span class="token operator">==</span> <span class="token number">0</span><span class="token operator">:</span>
    #         <span class="token keyword control-flow">return</span> line
    #     <span class="token keyword control-flow">return</span> line <span class="token operator">+</span> <span class="token string">"已作修改！"</span>
    #
    # <span class="token function">text_line_ctl</span><span class="token punctuation">(</span><span class="token string">"leyu_share_links.txt"</span><span class="token punctuation">,</span> _ctl<span class="token punctuation">)</span>
    ##
    def <span class="token function">join</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> between_str<span class="token punctuation">)</span><span class="token operator">:</span>
        result <span class="token operator">=</span> <span class="token string">''</span>
        length <span class="token operator">=</span> <span class="token function">len</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span>
        <span class="token keyword control-flow">for</span> n <span class="token keyword">in</span> <span class="token function">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> length<span class="token punctuation">)</span><span class="token operator">:</span>
            result <span class="token operator">+=</span> <span class="token punctuation">(</span>arr<span class="token punctuation">[</span>n<span class="token punctuation">]</span> <span class="token operator">+</span> between_str<span class="token punctuation">)</span>
        <span class="token keyword control-flow">return</span> result
    <span class="token keyword control-flow">try</span><span class="token operator">:</span>
        r <span class="token operator">=</span> <span class="token function">open</span><span class="token punctuation">(</span>local_file_path<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
        split <span class="token operator">=</span> r<span class="token punctuation">.</span><span class="token method function property-access">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">split</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span>
        <span class="token keyword control-flow">if</span> split<span class="token punctuation">[</span><span class="token function">len</span><span class="token punctuation">(</span>split<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">""</span><span class="token operator">:</span>
            del split<span class="token punctuation">[</span><span class="token function">len</span><span class="token punctuation">(</span>split<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span>
        temp_file <span class="token operator">=</span> <span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"ctl-{}"</span><span class="token punctuation">.</span><span class="token method function property-access">format</span><span class="token punctuation">(</span>local_file_path<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'w+'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span>
        <span class="token keyword control-flow">for</span> n <span class="token keyword">in</span> <span class="token function">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>split<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">:</span>
            new_line <span class="token operator">=</span> <span class="token function">ctl_fun</span><span class="token punctuation">(</span>split<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span>

            temp_file<span class="token punctuation">.</span><span class="token method function property-access">write</span><span class="token punctuation">(</span>new_line<span class="token operator">+</span><span class="token string">"\n"</span><span class="token punctuation">)</span>
            temp_file<span class="token punctuation">.</span><span class="token method function property-access">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

            split<span class="token punctuation">[</span>n<span class="token punctuation">]</span> <span class="token operator">=</span> new_line
        new_text <span class="token operator">=</span> <span class="token function">join</span><span class="token punctuation">(</span>split<span class="token punctuation">,</span> <span class="token string">"\n"</span><span class="token punctuation">)</span>
        w <span class="token operator">=</span> <span class="token function">open</span><span class="token punctuation">(</span>local_file_path<span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
        w<span class="token punctuation">.</span><span class="token method function property-access">write</span><span class="token punctuation">(</span>new_text<span class="token punctuation">)</span>
    <span class="token keyword control-flow">finally</span><span class="token operator">:</span>
        temp_file<span class="token punctuation">.</span><span class="token method function property-access">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        r<span class="token punctuation">.</span><span class="token method function property-access">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        w<span class="token punctuation">.</span><span class="token method function property-access">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   
#对文本文件的内容进行替换 <span class="token function">replace_text_content</span><span class="token punctuation">(</span><span class="token string">"leyu_share_links.txt"</span><span class="token punctuation">,</span> <span class="token string">"lanzous"</span><span class="token punctuation">,</span> <span class="token string">"lanzoui"</span><span class="token punctuation">)</span>
def <span class="token function">replace_text_content</span><span class="token punctuation">(</span>file_path<span class="token punctuation">,</span>update_before<span class="token punctuation">,</span>update_after<span class="token punctuation">)</span><span class="token operator">:</span>
    file_r <span class="token operator">=</span> <span class="token function">open</span><span class="token punctuation">(</span>file_path<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span>

    <span class="token keyword control-flow">try</span><span class="token operator">:</span>
        new_text_content <span class="token operator">=</span> <span class="token function">ctl_string</span><span class="token punctuation">(</span>file_r<span class="token punctuation">.</span><span class="token method function property-access">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>update_before<span class="token punctuation">,</span> update_after<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token function">print</span><span class="token punctuation">(</span>new_text_content<span class="token punctuation">)</span>
        file_w <span class="token operator">=</span> <span class="token function">open</span><span class="token punctuation">(</span>file_path<span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span>
        file_w<span class="token punctuation">.</span><span class="token method function property-access">write</span><span class="token punctuation">(</span>new_text_content<span class="token punctuation">)</span>
    <span class="token keyword control-flow">finally</span><span class="token operator">:</span>
        file_r<span class="token punctuation">.</span><span class="token method function property-access">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        file_w<span class="token punctuation">.</span><span class="token method function property-access">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</pre></div></code-block><h2 class="wolai-block"><span class="inline-wrap">控制浏览器</span></h2><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="Python==" class="marker"></div><pre><span class="token keyword module">from</span> selenium <span class="token keyword module">import</span> webdriver
#需要下载安装 chromedriver<span class="token punctuation">.</span><span class="token property-access">exe</span>
#下载：https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>npm<span class="token punctuation">.</span><span class="token property-access">taobao</span><span class="token punctuation">.</span><span class="token property-access">org</span><span class="token operator">/</span>mirrors<span class="token operator">/</span>chromedriver
#文档：https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span><span class="token property-access">selenium</span><span class="token punctuation">.</span><span class="token property-access">dev</span><span class="token operator">/</span>zh<span class="token operator">-</span>cn<span class="token operator">/</span>documentation<span class="token operator">/</span>overview<span class="token operator">/</span>
browser <span class="token operator">=</span> webdriver<span class="token punctuation">.</span><span class="token method function property-access"><span class="token maybe-class-name">Chrome</span></span><span class="token punctuation">(</span>executable_path<span class="token operator">=</span><span class="token string">'./chromedriver.exe'</span><span class="token punctuation">)</span>
def <span class="token function">tips_and_go</span><span class="token punctuation">(</span>selector<span class="token punctuation">)</span><span class="token operator">:</span>
    elem <span class="token operator">=</span> browser<span class="token punctuation">.</span><span class="token method function property-access">find_element_by_css_selector</span><span class="token punctuation">(</span>selector<span class="token punctuation">)</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"开始点击：{}"</span><span class="token punctuation">.</span><span class="token method function property-access">format</span><span class="token punctuation">(</span>elem<span class="token punctuation">.</span><span class="token property-access">text</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    elem<span class="token punctuation">.</span><span class="token method function property-access">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    # 等待新标签页完成加载内容
def <span class="token function">to_last_window</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span>
    window_ids <span class="token operator">=</span> browser<span class="token punctuation">.</span><span class="token property-access">window_handles</span>
    last_id <span class="token operator">=</span> window_ids<span class="token punctuation">[</span><span class="token function">len</span><span class="token punctuation">(</span>window_ids<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
    browser<span class="token punctuation">.</span><span class="token property-access">switch_to</span><span class="token punctuation">.</span><span class="token method function property-access">window</span><span class="token punctuation">(</span>last_id<span class="token punctuation">)</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"当前窗口是：{}"</span><span class="token punctuation">.</span><span class="token method function property-access">format</span><span class="token punctuation">(</span>browser<span class="token punctuation">.</span><span class="token property-access">current_window_handle</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

def <span class="token function">close_window</span><span class="token punctuation">(</span>closed_to<span class="token punctuation">)</span><span class="token operator">:</span>
    browser<span class="token punctuation">.</span><span class="token method function property-access">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    window_ids <span class="token operator">=</span> browser<span class="token punctuation">.</span><span class="token property-access">window_handles</span>
    browser<span class="token punctuation">.</span><span class="token property-access">switch_to</span><span class="token punctuation">.</span><span class="token method function property-access">window</span><span class="token punctuation">(</span>window_ids<span class="token punctuation">[</span>closed_to<span class="token punctuation">]</span><span class="token punctuation">)</span>
def <span class="token function">end_browser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span>
    <span class="token keyword control-flow">for</span> id <span class="token keyword">in</span> browser<span class="token punctuation">.</span><span class="token property-access">window_handles</span><span class="token operator">:</span>
        <span class="token function">to_last_window</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        browser<span class="token punctuation">.</span><span class="token method function property-access">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

browser<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">"https://www.baidu.com"</span><span class="token punctuation">)</span>
<span class="token function">tips_and_go</span><span class="token punctuation">(</span><span class="token string">"#s-top-left > a:nth-child(1)"</span><span class="token punctuation">)</span>
<span class="token function">to_last_window</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">tips_and_go</span><span class="token punctuation">(</span><span class="token string">'#channel-all > div > ul > li:nth-child(3) > a'</span><span class="token punctuation">)</span>

<span class="token function">close_window</span><span class="token punctuation">(</span>closed_to<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>browser<span class="token punctuation">.</span><span class="token property-access">current_window_handle</span><span class="token punctuation">)</span>

<span class="token function">end_browser</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div></article><footer></footer></body></html>